{% extends 'layout.html' %}

{% block title %}Mapa{%endblock%}

{% block head %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
   integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
   crossorigin=""/>
   <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
   integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
   crossorigin=""></script>
   <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css"></link>
   <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"></link>
   <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
{%endblock%}

{%block content%}
{{block.super}}

<div id="map"></div>
<h1>
    
</h1>

<script>
    var map = L.map('map').setView([41.389033,2.150984], 13);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    var markers = L.markerClusterGroup();

    function addMarker(Y, X, Desc) {
        L.marker([Y, X]).addTo(map)
        .bindPopup(Desc);
    }

    function addMarkerCluster(X, Y, Desc){
        var marker = L.marker(new L.LatLng(X,Y), {title: Desc});
        marker.bindPopup(Desc);
        markers.addLayer(marker);
    }

    {% for x in item %}
        //addMarker({{x.Longitude}},{{x.Latitude}},"{{x.id}} {{x.Code}} {{x.District_Name}}");
        addMarkerCluster({{x.Latitude}},{{x.Longitude}},"{{x.id}} {{x.Code}} {{x.District_Name}} <br> Lat: {{x.Latitude}}, Lon: {{x.Longitude}}");
    {% endfor %}

    map.addLayer(markers);

</script>

{%endblock%}